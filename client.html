<html>
<head>
    <title>Client</title>
</head>
<body>
    <video autoplay></video>
    <script>
        const video = document.querySelector('video')

        const mediaSource = new MediaSource()
        video.src = URL.createObjectURL(mediaSource)

        mediaSource.addEventListener('sourceopen', e => {
            const sourceBuffer = mediaSource.addSourceBuffer('video/webm;codecs=vp8,opus')
            ws.onmessage = message => {
                console.log(message)
                new Response(message.data)
                    .arrayBuffer()
                    .then(buffer => {
                        sourceBuffer.addEventListener('updateend', () => {
                            mediaSource.endOfStream()
                            video.play()
                        })
                        sourceBuffer.appendBuffer(buffer)
                    })
            }
        })
        const ws = new WebSocket('ws://localhost:3000')
    </script>
</body>
</html>
